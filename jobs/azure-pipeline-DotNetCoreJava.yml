parameters:
  name: 'Build & Test'
  vstsFeedId: '0bb8fdf9-08cc-423c-8a96-81a1e4d65711'
  pool: 'Azure-VSTS-VS2017'
  azureSubscription: 'Reform-CFT-VH-Dev'
  
jobs:
- job: 
  displayName: ${{ parameters.name }}
  pool: ${{ parameters.pool }}
  # Reference templae for setting up build tools
  steps:
    - template: ../templates/Common/common.yml

  # Performs npm steps - install, build, test, test publishing
    - template: ../templates/npm.yml

  # SonarCloud Prepare step
    - template: ../templates/SonarCloud/SonarCloudPrepare.yml
      parameters:
        sonarCloudProjectKey: 'uk.gov.hmcts.vh:$(vh-website)'
        sonarCloudprojectName: '$(Build.Repository.Name)'
        sonarCloudextraProperties: ''

  # Restore NuGet packages and build VS solution
    - template: ../templates/VSBuild/VSBuild.yml

  # Executes tests and publishes results
    - template: ../templates/Tests/RunTests.yml

  # Publish artifacts
    - template: ../templates/PublishArtifacts/PublishArtifacts.yml
