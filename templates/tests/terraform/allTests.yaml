parameters:
  - name: terraformPath
    type: string
  - name: subscription
    type: string
  - name: resourceGroupName
    type: string
  - name: resourceGroupLocation
    type: string
  - name: storageAccount
    type: string
  - name: contianerName
    type: string
  - name: stateFile
    type: string

steps:
  - task: TerraformCLI@0
    displayName: Terraform init
    inputs:
      command: init
      workingDirectory: ${{ parameters.terraformPath }}
      backendType: azurerm
      backendServiceArm: ${{ parameters.subscription }}
      backendAzureRmResourceGroupName: ${{ parameters.resourceGroupName }}
      backendAzureRmResourceGroupLocation: ${{ parameters.resourceGroupLocation }}
      backendAzureRmStorageAccountName: ${{ parameters.storageAccount }}
      backendAzureRmContainerName: ${{ parameters.contianerName }}
      backendAzureRmKey: ${{ parameters.stateFile }}

  - templates: format.yaml
    parameters:
      terraformPath: ${{ parameters.terraformPath }}

  - templates: fileSize.yaml

  - templates: secrets.yaml