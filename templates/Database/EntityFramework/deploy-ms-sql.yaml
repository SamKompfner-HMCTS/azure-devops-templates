parameters:
  - name: azureSubscription
    type: string
  - name: dbServerName
    type: string
  - name: databaseName
    type: string
  - name: sqlScriptLocation
    type: string
  - name: connectionString
    type: string
    default: null


steps:
  - task: SqlAzureDacpacDeployment@1
    inputs:
      azureSubscription: '${{ parameters.azureSubscription }}'
      ${{ if ne(parameters.connectionString, null) }}:
        AuthenticationType: 'connectionString'
      ${{ else }}:
        AuthenticationType: 'servicePrincipal'
      ConnectionString: ${{ parameters.connectionString }}
      ServerName: '${{ parameters.dbServerName }}.database.windows.net'
      DatabaseName: '${{ parameters.databaseName }}'
      deployType: 'SqlTask'
      SqlFile: '${{ parameters.sqlScriptLocation }}'
      IpDetectionMethod: 'AutoDetect'