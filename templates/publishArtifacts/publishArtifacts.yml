steps:
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: WebApp'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)\WebApp'
      ArtifactName: WebApp

  - powershell: |
     $AcceptanceTestsPath = (Resolve-Path $(Build.SourcesDirectory)\**\*.AcceptanceTests\bin\**).path
     if ($null -eq $AcceptanceTestsPath){
     Write-Output "##vso[task.logissue type=warning]Acceptance Tests not found"
     }
     else{
     Write-Output "##vso[task.setvariable variable=AcceptanceTestsPath;]$AcceptanceTestsPath"
     Write-Output ("Acctepance Tests path {0}" -f $AcceptanceTestsPath)
     }
    displayName: Resolve Acceptance Tests bin path

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifacts: Acceptance Tests'
    inputs:
      PathtoPublish: '$(AcceptanceTestsPath)'
      ArtifactName: AcceptanceTests
    condition: ne(variables['AcceptanceTestsPath'], '')

  - powershell: |
     $infrastructurePath = (Resolve-Path $(Build.SourcesDirectory)\Infrastructure -ErrorAction Continue).path
     if ($null -eq $infrastructurePath){
     Write-Output "##vso[task.logissue type=warning]Infrastructure files not found"
     }
     else{
     Write-Output "##vso[task.setvariable variable=Infrastructure;]$infrastructurePath"
     Write-Output ("Infrastructure file path {0}" -f $infrastructurePath)
     }
    displayName: Resolve Infrastructure files path

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: Infrastructure'
    inputs:
      PathtoPublish: Infrastructure
      ArtifactName: Infrastructure
    condition: ne(variables['Infrastructure'], '')
